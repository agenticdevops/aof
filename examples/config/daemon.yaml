# AOF Daemon Configuration
#
# Configuration for AOF daemon server.
#
# Prerequisites:
#   Set environment variables for enabled platforms:
#   - Slack:      SLACK_BOT_TOKEN, SLACK_SIGNING_SECRET
#   - Telegram:   TELEGRAM_BOT_TOKEN
#   - GitHub:     GITHUB_TOKEN, GITHUB_WEBHOOK_SECRET
#   - GitLab:     GITLAB_TOKEN, GITLAB_WEBHOOK_SECRET (experimental)
#   - Bitbucket:  BITBUCKET_USERNAME, BITBUCKET_APP_PASSWORD, BITBUCKET_WEBHOOK_SECRET (experimental)
#   - LLM:        GOOGLE_API_KEY (or ANTHROPIC_API_KEY/OPENAI_API_KEY)
#
# Usage:
#   export SLACK_BOT_TOKEN=xoxb-xxxxx
#   export SLACK_SIGNING_SECRET=xxxxx
#   export TELEGRAM_BOT_TOKEN=xxxxx
#   export GITHUB_TOKEN=ghp_xxxxx
#   export GITHUB_WEBHOOK_SECRET=xxxxx
#   export GOOGLE_API_KEY=xxxxx
#
#   aofctl serve --config examples/config/daemon.yaml
#
# Expose webhooks (choose one):
#   # Cloudflared (recommended - no signup needed):
#   brew install cloudflared
#   cloudflared tunnel --url http://localhost:3000
#
#   # Or ngrok (requires free account):
#   ngrok http 3000
#
# Webhook URLs:
#   Slack:     https://your-tunnel-url/webhook/slack
#   Telegram:  https://your-tunnel-url/webhook/telegram
#   GitHub:    https://your-tunnel-url/webhook/github
#   GitLab:    https://your-tunnel-url/webhook/gitlab
#   Bitbucket: https://your-tunnel-url/webhook/bitbucket

apiVersion: aof.dev/v1
kind: DaemonConfig
metadata:
  name: aof-daemon
  labels:
    environment: development

spec:
  # =============================================================================
  # Server Configuration
  # =============================================================================
  server:
    port: 3000
    host: 0.0.0.0
    cors: true
    timeout_secs: 60

  # =============================================================================
  # Platform Integrations
  # Enable/disable platforms as needed. Only enabled platforms require env vars.
  #
  # NOTE: In future versions, platform config will move entirely to Trigger files.
  # For now, platforms must be enabled here for the webhook endpoints to work.
  # =============================================================================
  platforms:
    # Slack Bot
    # Setup: https://api.slack.com/apps â†’ Create App â†’ Enable Event Subscriptions
    slack:
      enabled: true
      bot_token_env: SLACK_BOT_TOKEN
      signing_secret_env: SLACK_SIGNING_SECRET

    # Telegram Bot
    # Setup: Message @BotFather on Telegram â†’ /newbot
    telegram:
      enabled: true
      bot_token_env: TELEGRAM_BOT_TOKEN

    # =========================================================================
    # Git Platform Integrations (PR/MR Automation)
    # =========================================================================

    # GitHub âœ… Stable
    # Setup: https://github.com/settings/tokens â†’ Generate new token (classic)
    #        Repo Settings â†’ Webhooks â†’ Add webhook
    # Scopes: repo, write:discussion (for PR comments/reviews)
    github:
      enabled: true
      token_env: GITHUB_TOKEN
      webhook_secret_env: GITHUB_WEBHOOK_SECRET
      # Optional: Bot name for @mentions
      bot_name: aofbot

    # GitLab ðŸ§ª Experimental (untested - contributions welcome)
    # Setup: User Settings â†’ Access Tokens â†’ Create token (api scope)
    #        Project Settings â†’ Webhooks â†’ Add webhook
    gitlab:
      enabled: false  # Set to true when ready to test
      token_env: GITLAB_TOKEN
      webhook_secret_env: GITLAB_WEBHOOK_SECRET
      # Optional: Self-hosted GitLab instance
      # api_url: https://gitlab.example.com/api/v4

    # Bitbucket ðŸ§ª Experimental (untested - contributions welcome)
    # Setup: Personal settings â†’ App passwords â†’ Create
    #        Repository settings â†’ Webhooks â†’ Add webhook
    bitbucket:
      enabled: false  # Set to true when ready to test
      username_env: BITBUCKET_USERNAME
      app_password_env: BITBUCKET_APP_PASSWORD
      webhook_secret_env: BITBUCKET_WEBHOOK_SECRET
      # Optional: Bitbucket Server/Data Center
      # api_url: https://bitbucket.example.com/rest/api/1.0

  # =============================================================================
  # Triggers Configuration
  #
  # Triggers define command bindings for platforms.
  # See examples/triggers/ for Slack, Telegram examples.
  # =============================================================================
  triggers:
    directory: ./examples/triggers/
    watch: false

  # =============================================================================
  # Agent Configuration
  # =============================================================================
  agents:
    directory: ./examples/agents/
    watch: false

  # =============================================================================
  # Fleet Configuration
  # =============================================================================
  fleets:
    directory: ./examples/fleets/
    watch: false

  # =============================================================================
  # AgentFlow Configuration (Optional)
  # =============================================================================
  flows:
    directory: ./examples/flows/
    watch: false
    enabled: true

  # =============================================================================
  # Runtime Configuration
  # =============================================================================
  runtime:
    max_concurrent_tasks: 10
    task_timeout_secs: 300
    max_tasks_per_user: 5
    default_agent: devops
