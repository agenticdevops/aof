# AOF Daemon Configuration
#
# Unified configuration for all platform integrations (Slack, Telegram, Discord, etc.)
# This is the primary example config - copy and customize for your deployment.
#
# Prerequisites:
#   Set environment variables for enabled platforms:
#   - Slack:    SLACK_BOT_TOKEN, SLACK_SIGNING_SECRET
#   - Telegram: TELEGRAM_BOT_TOKEN
#   - Discord:  DISCORD_BOT_TOKEN, DISCORD_APPLICATION_ID
#   - WhatsApp: WHATSAPP_PHONE_NUMBER_ID, WHATSAPP_ACCESS_TOKEN, WHATSAPP_VERIFY_TOKEN
#   - LLM:      GOOGLE_API_KEY (or ANTHROPIC_API_KEY/OPENAI_API_KEY)
#
# Usage:
#   export SLACK_BOT_TOKEN=xoxb-xxxxx
#   export SLACK_SIGNING_SECRET=xxxxx
#   export TELEGRAM_BOT_TOKEN=xxxxx
#   export GOOGLE_API_KEY=xxxxx
#
#   aofctl serve --config examples/config/daemon.yaml
#
# Expose webhooks (choose one):
#   # Cloudflared (recommended - no signup needed):
#   brew install cloudflared
#   cloudflared tunnel --url http://localhost:3000
#
#   # Or ngrok (requires free account):
#   ngrok http 3000
#
# Webhook URLs:
#   Slack:    https://your-tunnel-url/webhook/slack
#   Telegram: https://your-tunnel-url/webhook/telegram
#   Discord:  https://your-tunnel-url/webhook/discord
#   WhatsApp: https://your-tunnel-url/webhook/whatsapp

apiVersion: aof.dev/v1
kind: DaemonConfig
metadata:
  name: aof-daemon
  labels:
    environment: development

spec:
  # =============================================================================
  # Server Configuration
  # =============================================================================
  server:
    port: 3000
    host: 0.0.0.0
    cors: true
    timeout_secs: 60

  # =============================================================================
  # Platform Integrations
  # Enable/disable platforms as needed. Only enabled platforms require env vars.
  # =============================================================================
  platforms:
    # ---------------------------------------------------------------------------
    # Slack Bot
    # Setup: https://api.slack.com/apps → Create App → Enable Event Subscriptions
    # Scopes: app_mentions:read, chat:write, im:history, im:read, im:write
    # ---------------------------------------------------------------------------
    slack:
      enabled: true
      bot_token_env: SLACK_BOT_TOKEN
      signing_secret_env: SLACK_SIGNING_SECRET
      # Approval Whitelist - Only these users can approve destructive commands
      # Leave empty or omit to allow anyone to approve (default behavior)
      # approval_allowed_users:
      #   - U12345678         # Replace with actual Slack user IDs
      #   - U87654321         # Multiple users can be whitelisted

    # ---------------------------------------------------------------------------
    # Telegram Bot
    # Setup: Message @BotFather on Telegram → /newbot
    # Set webhook: https://api.telegram.org/bot<TOKEN>/setWebhook?url=<YOUR_URL>/webhook/telegram
    # ---------------------------------------------------------------------------
    telegram:
      enabled: true
      bot_token_env: TELEGRAM_BOT_TOKEN
      # Optional: webhook secret for verification (set in BotFather)
      webhook_secret: null

    # ---------------------------------------------------------------------------
    # Discord Bot (not yet implemented)
    # Setup: https://discord.com/developers/applications → New Application
    # ---------------------------------------------------------------------------
    # discord:
    #   enabled: false
    #   bot_token_env: DISCORD_BOT_TOKEN
    #   application_id_env: DISCORD_APPLICATION_ID

    # ---------------------------------------------------------------------------
    # WhatsApp Business API (not yet implemented)
    # Setup: https://developers.facebook.com/apps → Create App → WhatsApp
    # ---------------------------------------------------------------------------
    # whatsapp:
    #   enabled: false
    #   phone_number_id_env: WHATSAPP_PHONE_NUMBER_ID
    #   access_token_env: WHATSAPP_ACCESS_TOKEN
    #   verify_token_env: WHATSAPP_VERIFY_TOKEN

  # =============================================================================
  # Agent Configuration
  # =============================================================================
  agents:
    # Directory containing Agent YAML files
    directory: ./examples/agents/
    # Hot-reload agents on file changes (useful for development)
    watch: false

  # =============================================================================
  # AgentFlow Routing (Optional)
  # Enables multi-tenant bot architecture with flow-based message routing.
  # When enabled, incoming messages are matched against flows before
  # falling back to default_agent.
  # =============================================================================
  flows:
    # Directory containing AgentFlow YAML files
    directory: ./examples/flows/multi-tenant/
    # Hot-reload flows on file changes
    watch: false
    # Enable flow-based routing (takes priority over default_agent)
    enabled: true

  # =============================================================================
  # Fleets Configuration
  # Fleets are teams of agents that work together for complex tasks
  # =============================================================================
  fleets:
    # Directory containing Fleet YAML files
    directory: ./examples/fleets/
    # Hot-reload fleets on file changes
    watch: false

  # =============================================================================
  # Triggers Configuration
  # Triggers define message sources with command bindings.
  # Each Trigger file is self-contained: platform config + commands.
  # =============================================================================
  triggers:
    # Directory containing Trigger YAML files
    directory: ./examples/triggers/
    # Hot-reload triggers on file changes
    watch: false

  # =============================================================================
  # Runtime Configuration
  # =============================================================================
  runtime:
    # Maximum concurrent agent tasks across all users
    max_concurrent_tasks: 10
    # Timeout for individual agent tasks (seconds)
    task_timeout_secs: 300
    # Maximum concurrent tasks per user (prevents abuse)
    max_tasks_per_user: 5
    # Default agent for @mentions and natural language messages
    # Slash commands (/run, /status, etc.) work independently
    default_agent: devops
