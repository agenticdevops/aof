# Slack Bot Daemon Configuration
#
# This config starts the AOF server to receive Slack webhooks
# and route them to agents.
#
# Prerequisites:
# - SLACK_BOT_TOKEN environment variable (xoxb-...)
# - SLACK_SIGNING_SECRET environment variable
# - GOOGLE_API_KEY (or ANTHROPIC_API_KEY/OPENAI_API_KEY)
#
# Usage:
#   export SLACK_BOT_TOKEN=xoxb-xxxxx
#   export SLACK_SIGNING_SECRET=xxxxx
#   export GOOGLE_API_KEY=xxxxx
#
#   aofctl serve --config examples/config/slack-daemon.yaml
#
#   # Then expose with cloudflared (recommended - no signup needed):
#   brew install cloudflared
#   cloudflared tunnel --url http://localhost:3000
#
#   # Or use ngrok (requires free account):
#   ngrok http 3000
#
#   # Configure Slack Request URL to: https://your-tunnel-url/webhook/slack

apiVersion: aof.dev/v1
kind: DaemonConfig
metadata:
  name: slack-bot

spec:
  server:
    port: 3000
    host: 0.0.0.0
    cors: true
    timeout_secs: 60

  platforms:
    slack:
      enabled: true
      bot_token_env: SLACK_BOT_TOKEN
      signing_secret_env: SLACK_SIGNING_SECRET

      # Approval Whitelist (optional)
      # Restrict who can approve destructive commands (delete, scale, apply, etc.)
      # If not set, anyone can approve. Supports:
      # - Raw Slack user IDs: "U12345678"
      # - Platform-prefixed: "slack:U12345678" (for future multi-platform support)
      # - Email format (future): "email:user@company.com"
      #
      # Example:
      # approval_allowed_users:
      #   - U12345678          # Slack user ID (find in Slack profile)
      #   - UABCDEFGH          # Another team member
      #   - slack:U98765432    # Platform-prefixed format

  agents:
    directory: ./examples/agents/
    watch: false

  # AgentFlow-based routing (optional - enables multi-tenant bot architecture)
  # When enabled, incoming messages are first matched against flows before
  # falling back to the default_agent
  flows:
    # Directory containing AgentFlow YAML files
    directory: ./examples/flows/multi-tenant/
    # Hot-reload on file changes
    watch: false
    # Enable flow-based routing (takes priority over default_agent)
    enabled: true

  runtime:
    max_concurrent_tasks: 10
    task_timeout_secs: 300
    max_tasks_per_user: 5
    # Default agent for @mentions and natural language messages
    # Slash commands (/run, /status, etc.) still work independently
    default_agent: slack-k8s-bot
